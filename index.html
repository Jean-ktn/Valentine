<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Our Universe</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Sarabun:wght@300;500&display=swap" rel="stylesheet" />

  <style>
    body, html {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background-color: #000;
      font-family: 'Sarabun', sans-serif;
    }

    #webgl {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 1;
      outline: none;
    }

    #ui-layer {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 10;
      pointer-events: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #light-burst {
      position: fixed;
      top: 50%; left: 50%;
      width: 0; height: 0;
      background: radial-gradient(circle, #fff 0%, rgba(255,255,255,0.8) 30%, transparent 70%);
      transform: translate(-50%, -50%);
      border-radius: 50%;
      opacity: 0;
      z-index: 5;
      pointer-events: none;
    }

    #start-instruction {
      position: absolute;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      text-align: center;
      color: rgba(255,255,255,0.9);
      text-shadow: 0 0 20px rgba(255,200,100,0.8);
      font-size: clamp(1rem, 3.5vw, 1.3rem);
      animation: pulseText 2s infinite;
      z-index: 20;
      pointer-events: auto;
      padding: 0 10px;
      box-sizing: border-box;
    }
    @keyframes pulseText { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

    /* Responsive gallery */
    #gallery-container {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.98);
      width: min(86vw, 320px);
      height: min(70vh, 420px);
      opacity: 0;
      visibility: hidden;
      z-index: 30;
      pointer-events: auto;
    }

    .photo-card {
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      border-radius: 25px;
      border: 2px solid rgba(255,255,255,0.4);
      padding: 20px;
      box-shadow: 0 0 80px rgba(255,160,0,0.5);
      display: flex; flex-direction: column; align-items: center;
      box-sizing: border-box;
    }

    .photo-frame {
      width: 100%; height: 75%;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .photo-slide {
      width: 100%; height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0; left: 0;
      opacity: 0; transition: opacity 1.2s;
    }
    .photo-slide.active { opacity: 1; }
    
    .video-slide {
      object-fit: cover;
    }

    .love-text {
      margin-top: 20px;
      color: #fff;
      text-align: center;
    }
    .love-text h2 {
      font-family: 'Dancing Script', cursive;
      font-size: clamp(1.8rem, 5vw, 2.2rem); 
      margin: 0;
      color: #ffe680;
      text-shadow: 0 0 20px rgba(255,230,128,0.6);
    }
    .love-text p {
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      margin: 8px 0 0;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    /* Fixed centered button */
    #give-flower-btn {
      position: absolute;
      bottom: clamp(18px, 8vh, 80px);
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      padding: clamp(12px, 3vw, 15px) clamp(22px, 6vw, 40px);
      background: linear-gradient(135deg, #ff8c00, #ffd700, #ff6b9d);
      border: none; border-radius: 50px;
      color: white; font-weight: bold;
      font-size: clamp(0.95rem, 2.8vw, 1.2rem);
      box-shadow: 0 5px 30px rgba(255,140,0,0.7);
      cursor: pointer;
      opacity: 0; visibility: hidden;
      z-index: 40;
      pointer-events: auto;
      transition: transform 0.3s;
      white-space: nowrap;
    }
    #give-flower-btn:hover { 
      transform: translateX(-50%) translateY(0) scale(1.05); 
    }

    /* === GARDEN SCENE === */
    #garden-scene {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 35;
      opacity: 0;
      visibility: hidden;
      background: radial-gradient(ellipse at center,
        rgba(20, 30, 20, 0.95) 0%,
        rgba(15, 25, 15, 0.98) 100%);
    }

    .garden-glow {
      position: absolute;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(ellipse at 30% 40%, rgba(255, 200, 150, 0.10) 0%, transparent 40%),
        radial-gradient(ellipse at 70% 60%, rgba(200, 150, 255, 0.10) 0%, transparent 40%),
        radial-gradient(ellipse at 50% 80%, rgba(150, 255, 200, 0.08) 0%, transparent 50%);
      pointer-events: none;
    }

    .garden-flowers {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    /* Outer wrapper animated by GSAP scale */
    .garden-flower {
      position: absolute;
      transform-origin: bottom center;
      opacity: 0;
      transform: scale(0);
      will-change: transform, opacity;
      pointer-events: none;
    }

    /* Inner wrapper does gentle sway (doesn't conflict with GSAP scale) */
    .garden-flower-inner {
      transform-origin: bottom center;
      animation: flower-sway 4.6s ease-in-out infinite;
      width: clamp(52px, 10vw, 120px);
      height: clamp(52px, 10vw, 120px);
      display: grid;
      place-items: center;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,0.35));
    }

    @keyframes flower-sway {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }

    .garden-flower-img {
      width: 100%;
      height: 100%;
      position: relative;
      transform: rotate(var(--img-rot, 0deg));
      filter:
        drop-shadow(0 10px 18px rgba(0,0,0,0.35))
        drop-shadow(0 0 18px rgba(255,255,255,0.10));
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }

    /* CSS Peony Flowers */
    .css-peony {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .peony-center {
      position: absolute;
      width: 18%;
      height: 18%;
      background: radial-gradient(circle at 30% 30%, 
        rgba(255, 230, 100, 1), 
        rgba(255, 200, 80, 0.95));
      border-radius: 50%;
      box-shadow: 
        inset -2px -2px 5px rgba(0,0,0,0.2),
        0 0 10px rgba(255,220,100,0.5);
      z-index: 10;
    }

    .peony-center::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%,
        transparent 0%,
        transparent 40%,
        rgba(200,150,50,0.3) 60%,
        transparent 100%);
      border-radius: 50%;
    }

    .peony-petal {
      position: absolute;
      width: 35%;
      height: 35%;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      transform-origin: center center;
      background: var(--petal-color);
      box-shadow: 
        inset -3px -5px 10px var(--petal-shadow),
        inset 3px 3px 8px var(--petal-light),
        0 4px 12px rgba(0,0,0,0.15);
    }

    /* Pink Peony Colors */
    .css-peony.pink .peony-petal {
      --petal-color: radial-gradient(ellipse at 35% 30%, 
        rgba(255, 182, 217, 1) 0%,
        rgba(255, 140, 180, 0.98) 30%,
        rgba(255, 105, 150, 0.95) 70%,
        rgba(240, 90, 130, 0.92) 100%);
      --petal-shadow: rgba(200, 60, 100, 0.3);
      --petal-light: rgba(255, 220, 240, 0.6);
    }

    /* White Peony Colors */
    .css-peony.white .peony-petal {
      --petal-color: radial-gradient(ellipse at 35% 30%, 
        rgba(255, 255, 255, 1) 0%,
        rgba(250, 250, 252, 0.98) 30%,
        rgba(245, 245, 250, 0.96) 70%,
        rgba(235, 235, 245, 0.94) 100%);
      --petal-shadow: rgba(200, 200, 220, 0.25);
      --petal-light: rgba(255, 255, 255, 0.8);
    }

    /* Petal positioning - outer layer (8 petals) */
    .peony-petal:nth-child(1) { transform: rotate(0deg) translateY(-85%) rotate(0deg); }
    .peony-petal:nth-child(2) { transform: rotate(45deg) translateY(-85%) rotate(-45deg); }
    .peony-petal:nth-child(3) { transform: rotate(90deg) translateY(-85%) rotate(-90deg); }
    .peony-petal:nth-child(4) { transform: rotate(135deg) translateY(-85%) rotate(-135deg); }
    .peony-petal:nth-child(5) { transform: rotate(180deg) translateY(-85%) rotate(-180deg); }
    .peony-petal:nth-child(6) { transform: rotate(225deg) translateY(-85%) rotate(-225deg); }
    .peony-petal:nth-child(7) { transform: rotate(270deg) translateY(-85%) rotate(-270deg); }
    .peony-petal:nth-child(8) { transform: rotate(315deg) translateY(-85%) rotate(-315deg); }

    /* Middle layer (8 petals, smaller, offset) */
    .peony-petal:nth-child(9) { transform: rotate(22.5deg) translateY(-60%) rotate(-22.5deg) scale(0.75); }
    .peony-petal:nth-child(10) { transform: rotate(67.5deg) translateY(-60%) rotate(-67.5deg) scale(0.75); }
    .peony-petal:nth-child(11) { transform: rotate(112.5deg) translateY(-60%) rotate(-112.5deg) scale(0.75); }
    .peony-petal:nth-child(12) { transform: rotate(157.5deg) translateY(-60%) rotate(-157.5deg) scale(0.75); }
    .peony-petal:nth-child(13) { transform: rotate(202.5deg) translateY(-60%) rotate(-202.5deg) scale(0.75); }
    .peony-petal:nth-child(14) { transform: rotate(247.5deg) translateY(-60%) rotate(-247.5deg) scale(0.75); }
    .peony-petal:nth-child(15) { transform: rotate(292.5deg) translateY(-60%) rotate(-292.5deg) scale(0.75); }
    .peony-petal:nth-child(16) { transform: rotate(337.5deg) translateY(-60%) rotate(-337.5deg) scale(0.75); }

    /* Inner layer (6 petals, smallest) */
    .peony-petal:nth-child(17) { transform: rotate(0deg) translateY(-35%) rotate(0deg) scale(0.5); z-index: 5; }
    .peony-petal:nth-child(18) { transform: rotate(60deg) translateY(-35%) rotate(-60deg) scale(0.5); z-index: 5; }
    .peony-petal:nth-child(19) { transform: rotate(120deg) translateY(-35%) rotate(-120deg) scale(0.5); z-index: 5; }
    .peony-petal:nth-child(20) { transform: rotate(180deg) translateY(-35%) rotate(-180deg) scale(0.5); z-index: 5; }
    .peony-petal:nth-child(21) { transform: rotate(240deg) translateY(-35%) rotate(-240deg) scale(0.5); z-index: 5; }
    .peony-petal:nth-child(22) { transform: rotate(300deg) translateY(-35%) rotate(-300deg) scale(0.5); z-index: 5; }

    /* Petal subtle animation variations */
    .peony-petal:nth-child(odd) {
      animation: petal-breathe-1 4s ease-in-out infinite;
    }

    .peony-petal:nth-child(even) {
      animation: petal-breathe-2 4.5s ease-in-out infinite;
    }

    @keyframes petal-breathe-1 {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.08); }
    }

    @keyframes petal-breathe-2 {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.05); }
    }

    /* === REALISTIC TULIP BOUQUET (CSS) === */
    #bouquet-container{
      position: fixed;
      bottom: -100%;
      left: 50%;
      transform: translateX(-50%);
      width: min(92vw, 640px);
      height: min(92vh, 760px);
      z-index: 40;
      perspective: 1400px;
      pointer-events: none;
    }

    .bouquet-wrapper{
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      filter: drop-shadow(0 35px 70px rgba(0,0,0,0.65));
      animation: gentle-sway 3.4s ease-in-out infinite;
    }

    .bouquet-flowers{
      position: absolute;
      inset: 0;
      transform-style: preserve-3d;
    }

    .css-tulip{
      position: absolute;
      width: 84px;
      height: 190px;
      left: var(--x);
      top: var(--y);
      transform-style: preserve-3d;
      transform:
        translate(-50%, -50%)
        rotate(var(--rot))
        translateZ(var(--z));
      z-index: var(--zi);
      pointer-events: none;
    }

    .tulip-unit{
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0);
      transform-origin: 50% 80%;
      opacity: 0;
    }

    .tulip-head{
      position: relative;
      width: 64px;
      height: 74px;
      margin: 0 auto;
      transform: rotateX(8deg);
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.35));
    }

    .tulip-glow{
      position:absolute;
      inset:-10px;
      background: radial-gradient(circle at 50% 60%,
        rgba(255,255,255,0.20) 0%,
        rgba(255,255,255,0.10) 25%,
        transparent 60%);
      filter: blur(2px);
      opacity: 0.9;
      pointer-events:none;
    }

    .tulip-petal{
      position: absolute;
      width: 38px;
      height: 62px;
      left: 50%;
      top: 6px;
      transform-origin: 50% 100%;
      border-radius: 60% 60% 40% 40% / 70% 70% 35% 35%;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.95), rgba(255,255,255,0.75) 42%, rgba(240,240,240,0.92) 75%),
        linear-gradient(to bottom, rgba(255,255,255,1), rgba(248,248,248,1));
      box-shadow:
        inset 0 -10px 18px rgba(0,0,0,0.10),
        inset -6px -10px 16px rgba(0,0,0,0.08),
        0 6px 14px rgba(0,0,0,0.18);
    }

    .tulip-petal.inner{
      width: 30px;
      height: 54px;
      top: 12px;
      opacity: 0.95;
      background:
        radial-gradient(circle at 35% 22%, rgba(255,255,255,0.98), rgba(255,255,255,0.78) 45%, rgba(235,235,235,0.95) 80%);
      box-shadow:
        inset 0 -10px 18px rgba(0,0,0,0.10),
        0 5px 10px rgba(0,0,0,0.12);
    }

    .tulip-petal.p1{ transform: translateX(-50%) rotate(-26deg) rotateY(-18deg); }
    .tulip-petal.p2{ transform: translateX(-50%) rotate(0deg)   rotateY(10deg); z-index: 3; }
    .tulip-petal.p3{ transform: translateX(-50%) rotate(26deg)  rotateY(-18deg); }
    .tulip-petal.inner.i1{ transform: translateX(-50%) rotate(-12deg) translateY(2px); z-index: 4; }
    .tulip-petal.inner.i2{ transform: translateX(-50%) rotate(12deg)  translateY(2px); z-index: 4; }

    .tulip-stem{
      position: absolute;
      left: 50%;
      top: 70px;
      width: 7px;
      height: 120px;
      transform: translateX(-50%) rotate(2deg);
      border-radius: 10px;
      background: linear-gradient(to bottom,
        rgba(120, 175, 85, 1),
        rgba(85, 140, 55, 1));
      box-shadow:
        inset -2px 0 6px rgba(0,0,0,0.28),
        0 10px 20px rgba(0,0,0,0.15);
    }

    .tulip-leaf{
      position: absolute;
      left: 50%;
      top: 118px;
      width: 56px;
      height: 22px;
      transform-origin: 0% 50%;
      transform: translateX(-4px) rotate(-18deg);
      border-radius: 0 100% 100% 0;
      background: linear-gradient(to right,
        rgba(95, 150, 65, 1),
        rgba(130, 190, 90, 1));
      box-shadow:
        inset -3px 0 7px rgba(0,0,0,0.22),
        0 8px 14px rgba(0,0,0,0.15);
      filter: saturate(1.05);
    }
    .tulip-leaf.alt{
      width: 46px;
      top: 134px;
      transform: translateX(-4px) rotate(18deg) scaleX(-1);
      opacity: 0.95;
    }

    .bouquet-paper{
      position: absolute;
      bottom: 78px;
      left: 50%;
      transform: translateX(-50%) translateZ(-40px);
      width: min(92%, 500px);
      height: 380px;
      z-index: -1;
    }

    .paper-sheet{
      position: absolute;
      inset: 0;
      transform-origin: bottom center;
      border-radius: 14px;
      box-shadow:
        0 20px 45px rgba(0,0,0,0.35),
        inset 0 2px 24px rgba(255,255,255,0.50);
      border: 1px solid rgba(255,255,255,0.35);
    }

    .paper-sheet:nth-child(1){
      clip-path: polygon(18% 0%, 82% 0%, 100% 100%, 0% 100%);
      transform: rotate(-12deg);
      background: linear-gradient(135deg, rgba(255,245,240,0.98), rgba(255,230,225,0.92));
    }
    .paper-sheet:nth-child(2){
      clip-path: polygon(15% 3%, 85% 3%, 100% 100%, 0% 100%);
      transform: rotate(12deg);
      background: linear-gradient(135deg, rgba(255,240,250,0.98), rgba(255,225,240,0.92));
    }
    .paper-sheet:nth-child(3){
      clip-path: polygon(22% 0%, 78% 0%, 100% 100%, 0% 100%);
      transform: rotate(0deg);
      opacity: 0.75;
      background: linear-gradient(135deg, rgba(250,245,255,0.98), rgba(245,235,250,0.90));
    }

    /* Ribbon bow */
    .bouquet-ribbon {
      position: absolute;
      bottom: 180px;
      left: 50%;
      transform: translateX(-50%) translateZ(-5px);
      width: 180px;
      height: 80px;
      z-index: 10;
    }

    .ribbon-loop {
      position: absolute;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg,
        rgba(255, 182, 217, 1),
        rgba(255, 105, 180, 1));
      border-radius: 50% 0% 50% 0%;
      box-shadow:
        inset -5px -5px 15px rgba(0, 0, 0, 0.2),
        5px 5px 20px rgba(255, 105, 180, 0.4);
    }
    .ribbon-loop:nth-child(1) { left: 0; transform: rotate(-40deg); }
    .ribbon-loop:nth-child(2) { right: 0; transform: rotate(40deg); }

    .ribbon-knot {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      background: radial-gradient(circle,
        rgba(255, 20, 147, 1),
        rgba(219, 39, 119, 1));
      border-radius: 50%;
      box-shadow:
        inset -3px -3px 10px rgba(0, 0, 0, 0.3),
        0 5px 15px rgba(255, 20, 147, 0.5);
      z-index: 5;
    }

    .ribbon-tail {
      position: absolute;
      bottom: -35px;
      width: 25px;
      height: 50px;
      background: linear-gradient(to bottom,
        rgba(255, 105, 180, 1),
        rgba(255, 20, 147, 1));
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.3);
    }
    .ribbon-tail:nth-child(4) { left: 25%; transform: rotate(-10deg); }
    .ribbon-tail:nth-child(5) { right: 25%; transform: rotate(10deg); }

    /* Valentine card responsive */
    #valentine-card {
      position: absolute;
      bottom: 150px;
      left: 50%;
      transform: translateX(-50%) scale(0);
      width: min(92vw, 400px);
      height: auto;
      z-index: 15;
      opacity: 0;
      pointer-events: none;
    }

    .card-container {
      position: relative;
      width: 100%;
      min-height: 240px;
      background: linear-gradient(135deg,
        rgba(255, 250, 250, 0.98),
        rgba(255, 240, 245, 0.95));
      border-radius: 20px;
      border: 3px solid rgba(255, 192, 203, 0.6);
      box-shadow:
        0 20px 60px rgba(255, 105, 180, 0.4),
        inset 0 2px 20px rgba(255, 255, 255, 0.5);
      padding: 28px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      box-sizing: border-box;
    }

    .card-hearts {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      overflow: hidden;
      border-radius: 20px;
    }

    .heart-decoration {
      position: absolute;
      width: 30px;
      height: 30px;
      opacity: 0.15;
    }

    .heart-decoration::before,
    .heart-decoration::after {
      content: '';
      position: absolute;
      width: 15px;
      height: 24px;
      background: #ff69b4;
      border-radius: 15px 15px 0 0;
    }

    .heart-decoration::before {
      left: 0;
      transform: rotate(-45deg);
      transform-origin: 0 100%;
    }

    .heart-decoration::after {
      left: 15px;
      transform: rotate(45deg);
      transform-origin: 100% 100%;
    }

    .heart-decoration:nth-child(1) { top: 10%; left: 10%; transform: rotate(15deg); }
    .heart-decoration:nth-child(2) { top: 15%; right: 12%; transform: rotate(-20deg); }
    .heart-decoration:nth-child(3) { bottom: 15%; left: 8%; transform: rotate(25deg); }
    .heart-decoration:nth-child(4) { bottom: 20%; right: 10%; transform: rotate(-15deg); }

    .card-message {
      position: relative;
      z-index: 2;
      text-align: center;
    }

    .card-message h1 {
      font-family: 'Dancing Script', cursive;
      font-size: clamp(2.6rem, 7vw, 3.5rem);
      margin: 0 0 10px 0;
      background: linear-gradient(135deg, #ff1493, #ff69b4, #ffb6c1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 5px 20px rgba(255, 105, 180, 0.3);
      animation: love-pulse 2s ease-in-out infinite;
    }

    @keyframes love-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .card-message p {
      font-family: 'Sarabun', sans-serif;
      font-size: clamp(1.05rem, 3.6vw, 1.3rem);
      color: #d81b60;
      margin: 10px 0 0 0;
      font-weight: 500;
      text-shadow: 0 2px 10px rgba(255, 105, 180, 0.2);
    }

    .card-sparkles {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, #fff, #ffb6c1);
      border-radius: 50%;
      animation: sparkle-twinkle 2s ease-in-out infinite;
      opacity: 0;
    }

    @keyframes sparkle-twinkle {
      0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 1; transform: scale(1) rotate(180deg); }
    }

    .sparkle:nth-child(1) { top: 20%; left: 15%; animation-delay: 0s; }
    .sparkle:nth-child(2) { top: 30%; right: 20%; animation-delay: 0.5s; }
    .sparkle:nth-child(3) { bottom: 25%; left: 20%; animation-delay: 1s; }
    .sparkle:nth-child(4) { bottom: 30%; right: 18%; animation-delay: 1.5s; }
    .sparkle:nth-child(5) { top: 50%; left: 10%; animation-delay: 0.3s; }
    .sparkle:nth-child(6) { top: 45%; right: 12%; animation-delay: 0.8s; }

    @keyframes gentle-sway{
      0%,100% { transform: rotateX(10deg) rotateZ(-3deg); }
      50%     { transform: rotateX(10deg) rotateZ(3deg); }
    }

    /* Mobile optimizations */
    @media (max-width: 480px) {
      #gallery-container {
        width: min(92vw, 320px);
        height: min(65vh, 400px);
      }
      
      .photo-card {
        padding: 15px;
      }
    }
  </style>
</head>

<body>
  <canvas id="webgl"></canvas>

  <div id="light-burst"></div>

  <div id="ui-layer">
    <div id="start-instruction">âœ¨ Click to see âœ¨</div>

    <div id="gallery-container">
      <div class="photo-card">
        <div class="photo-frame">
          <img src="photo1.jpg" class="photo-slide active" alt="Love Letter" />
          <img src="photo2.jpg" class="photo-slide" alt="Beautiful Flowers" />
          <video class="photo-slide video-slide" muted loop playsinline preload="auto">
            <source src="video1.mp4" type="video/mp4">
          </video>
        </div>
        <div class="love-text">
          <h2>My Sunshine âœ¨</h2>
          <p>My World is brighter when I'm with you</p>
        </div>
      </div>
    </div>

    <button id="give-flower-btn">ðŸŒ¸ For you ðŸŒ¸</button>
  </div>

  <!-- Garden Scene -->
  <div id="garden-scene">
    <div class="garden-glow"></div>
    <div class="garden-flowers" id="garden-flowers"></div>
  </div>

  <!-- Tulip Bouquet -->
  <div id="bouquet-container">
    <div class="bouquet-wrapper">
      <div class="bouquet-flowers" id="bouquet-flowers"></div>

      <div class="bouquet-paper">
        <div class="paper-sheet"></div>
        <div class="paper-sheet"></div>
        <div class="paper-sheet"></div>
      </div>

      <div id="valentine-card">
        <div class="card-container">
          <div class="card-hearts">
            <div class="heart-decoration"></div>
            <div class="heart-decoration"></div>
            <div class="heart-decoration"></div>
            <div class="heart-decoration"></div>
          </div>
          <div class="card-message">
            <h1>Happy Valentine na kub</h1>
            <p>Love youðŸ’•</p>
          </div>
          <div class="card-sparkles">
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Prevent error messages from showing in console
    window.addEventListener('error', function(e) {
      e.preventDefault();
      return true;
    });

    /***********************
     * THREE.JS SCENE
     ***********************/
    const canvas = document.querySelector('canvas#webgl');
    const scene = new THREE.Scene();

    // === GALAXY ===
    const parameters = {
      count: 50000,
      size: 0.012,
      radius: 5,
      branches: 3,
      spin: 1,
      randomness: 0.2,
      randomnessPower: 3,
      insideColor: '#ff6030',
      outsideColor: '#1b3984'
    };

    let geometry = null;
    let material = null;
    let points = null;

    const generateGalaxy = () => {
      if(points !== null) {
        geometry.dispose();
        material.dispose();
        scene.remove(points);
      }

      geometry = new THREE.BufferGeometry();
      const positions = new Float32Array(parameters.count * 3);
      const colors = new Float32Array(parameters.count * 3);

      const colorInside = new THREE.Color(parameters.insideColor);
      const colorOutside = new THREE.Color(parameters.outsideColor);

      for(let i = 0; i < parameters.count; i++) {
        const i3 = i * 3;
        const radius = Math.random() * parameters.radius;
        const spinAngle = radius * parameters.spin;
        const branchAngle = (i % parameters.branches) / parameters.branches * Math.PI * 2;

        const randomX = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1);
        const randomY = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1);
        const randomZ = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1);

        positions[i3    ] = Math.cos(branchAngle + spinAngle) * radius + randomX;
        positions[i3 + 1] = randomY;
        positions[i3 + 2] = Math.sin(branchAngle + spinAngle) * radius + randomZ;

        const mixedColor = colorInside.clone();
        mixedColor.lerp(colorOutside, radius / parameters.radius);

        colors[i3    ] = mixedColor.r;
        colors[i3 + 1] = mixedColor.g;
        colors[i3 + 2] = mixedColor.b;
      }

      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

      material = new THREE.PointsMaterial({
        size: parameters.size,
        sizeAttenuation: true,
        depthWrite: false,
        blending: THREE.AdditiveBlending,
        vertexColors: true
      });

      points = new THREE.Points(geometry, material);
      scene.add(points);
    }
    generateGalaxy();

    // === LIGHTING ===
    const ambientLight = new THREE.AmbientLight(0x1a1a2e, 0.3);
    scene.add(ambientLight);

    // === 3D SUN ===
    const sunGroup = new THREE.Group();
    const sunGeometry = new THREE.SphereGeometry(1, 128, 128);

    const sunMaterial = new THREE.ShaderMaterial({
      uniforms: {
        time: { value: 0 },
        colorCore: { value: new THREE.Color(0xffffff) },
        colorSurface: { value: new THREE.Color(0xffaa00) },
        colorEdge: { value: new THREE.Color(0xff6600) }
      },
      vertexShader: `
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;
        uniform float time;

        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }

        float snoise(vec3 v) {
          const vec2 C = vec2(1.0/6.0, 1.0/3.0);
          const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
          vec3 i  = floor(v + dot(v, C.yyy));
          vec3 x0 = v - i + dot(i, C.xxx);
          vec3 g = step(x0.yzx, x0.xyz);
          vec3 l = 1.0 - g;
          vec3 i1 = min(g.xyz, l.zxy);
          vec3 i2 = max(g.xyz, l.zxy);
          vec3 x1 = x0 - i1 + C.xxx;
          vec3 x2 = x0 - i2 + C.yyy;
          vec3 x3 = x0 - D.yyy;
          i = mod289(i);
          vec4 p = permute(permute(permute(
              i.z + vec4(0.0, i1.z, i2.z, 1.0))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0));
          float n_ = 0.142857142857;
          vec3 ns = n_ * D.wyz - D.xzx;
          vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
          vec4 x_ = floor(j * ns.z);
          vec4 y_ = floor(j - 7.0 * x_);
          vec4 x = x_ *ns.x + ns.yyyy;
          vec4 y = y_ *ns.x + ns.yyyy;
          vec4 h = 1.0 - abs(x) - abs(y);
          vec4 b0 = vec4(x.xy, y.xy);
          vec4 b1 = vec4(x.zw, y.zw);
          vec4 s0 = floor(b0)*2.0 + 1.0;
          vec4 s1 = floor(b1)*2.0 + 1.0;
          vec4 sh = -step(h, vec4(0.0));
          vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
          vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
          vec3 p0 = vec3(a0.xy, h.x);
          vec3 p1 = vec3(a0.zw, h.y);
          vec3 p2 = vec3(a1.xy, h.z);
          vec3 p3 = vec3(a1.zw, h.w);
          vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
          p0 *= norm.x;
          p1 *= norm.y;
          p2 *= norm.z;
          p3 *= norm.w;
          vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
          m = m * m;
          return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));
        }

        void main() {
          vNormal = normalize(normalMatrix * normal);
          vUv = uv;
          vec3 pos = position;
          float noise = snoise(pos * 2.0 + time * 0.5);
          noise += snoise(pos * 4.0 + time * 0.3) * 0.5;
          pos += normal * noise * 0.05;
          vPosition = pos;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
        }
      `,
      fragmentShader: `
        uniform float time;
        uniform vec3 colorCore;
        uniform vec3 colorSurface;
        uniform vec3 colorEdge;
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;

        void main() {
          vec3 viewDirection = normalize(cameraPosition - vPosition);
          float fresnel = pow(1.0 - dot(viewDirection, vNormal), 3.0);
          float pattern = sin(vUv.x * 20.0 + time) * cos(vUv.y * 20.0 + time) * 0.5 + 0.5;
          pattern += sin(vUv.x * 10.0 - time * 0.5) * 0.3;
          vec3 color = mix(colorCore, colorSurface, fresnel * 0.7);
          color = mix(color, colorEdge, fresnel);
          color += pattern * 0.2;
          float pulse = sin(time * 2.0) * 0.1 + 0.9;
          color *= pulse;
          gl_FragColor = vec4(color, 1.0);
        }
      `
    });

    const sun = new THREE.Mesh(sunGeometry, sunMaterial);
    sunGroup.add(sun);

    for(let i = 0; i < 5; i++) {
      const scale = 1.2 + i * 0.15;
      const opacity = 0.25 - i * 0.04;
      const coronaGeo = new THREE.SphereGeometry(scale, 64, 64);
      const coronaMat = new THREE.ShaderMaterial({
        transparent: true,
        side: THREE.BackSide,
        blending: THREE.AdditiveBlending,
        uniforms: {
          time: { value: 0 },
          opacity: { value: opacity },
          color: { value: new THREE.Color(0xffaa00) }
        },
        vertexShader: `
          varying vec3 vNormal;
          void main() {
            vNormal = normalize(normalMatrix * normal);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform float opacity;
          uniform vec3 color;
          varying vec3 vNormal;
          void main() {
            float intensity = pow(0.7 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0);
            float flicker = sin(time * 3.0 + gl_FragCoord.x * 0.1) * 0.2 + 0.8;
            gl_FragColor = vec4(color, intensity * opacity * flicker);
          }
        `
      });
      const corona = new THREE.Mesh(coronaGeo, coronaMat);
      sunGroup.add(corona);
    }

    const flareCount = 200;
    const flareGeometry = new THREE.BufferGeometry();
    const flarePositions = new Float32Array(flareCount * 3);

    for(let i = 0; i < flareCount; i++) {
      const radius = 1.5 + Math.random() * 1;
      const theta = Math.random() * Math.PI * 2;
      const phi = Math.random() * Math.PI;
      flarePositions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
      flarePositions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
      flarePositions[i * 3 + 2] = radius * Math.cos(phi);
    }

    flareGeometry.setAttribute('position', new THREE.BufferAttribute(flarePositions, 3));
    const flareMaterial = new THREE.PointsMaterial({
      color: 0xffdd00,
      size: 0.05,
      transparent: true,
      opacity: 0.6,
      blending: THREE.AdditiveBlending
    });
    const flares = new THREE.Points(flareGeometry, flareMaterial);
    sunGroup.add(flares);

    const sunLight = new THREE.PointLight(0xffd700, 3, 20);
    sunGroup.add(sunLight);
    sunGroup.position.set(-3, 1.5, 2);
    scene.add(sunGroup);

    // === 3D MOON ===
    const moonGroup = new THREE.Group();
    const moonGeometry = new THREE.SphereGeometry(0.8, 128, 128);

    const moonMaterial = new THREE.ShaderMaterial({
      uniforms: {
        time: { value: 0 },
        sunPosition: { value: sunGroup.position }
      },
      vertexShader: `
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;
        uniform float time;

        float hash(vec2 p) {
          return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
        }

        float noise(vec2 p) {
          vec2 i = floor(p);
          vec2 f = fract(p);
          f = f * f * (3.0 - 2.0 * f);
          float a = hash(i);
          float b = hash(i + vec2(1.0, 0.0));
          float c = hash(i + vec2(0.0, 1.0));
          float d = hash(i + vec2(1.0, 1.0));
          return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
        }

        void main() {
          vNormal = normalize(normalMatrix * normal);
          vUv = uv;
          vec3 pos = position;
          float craters = noise(uv * 20.0) * 0.5;
          craters += noise(uv * 40.0) * 0.25;
          craters += noise(uv * 80.0) * 0.125;
          pos += normal * craters * 0.03;
          vPosition = pos;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
        }
      `,
      fragmentShader: `
        uniform float time;
        uniform vec3 sunPosition;
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;

        float hash(vec2 p) {
          return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
        }

        float noise(vec2 p) {
          vec2 i = floor(p);
          vec2 f = fract(p);
          f = f * f * (3.0 - 2.0 * f);
          float a = hash(i);
          float b = hash(i + vec2(1.0, 0.0));
          float c = hash(i + vec2(0.0, 1.0));
          float d = hash(i + vec2(1.0, 1.0));
          return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
        }

        void main() {
          float surface = noise(vUv * 10.0);
          vec3 baseColor = vec3(0.7, 0.7, 0.7);
          vec3 darkColor = vec3(0.4, 0.4, 0.4);
          vec3 color = mix(darkColor, baseColor, surface);

          float craterPattern = noise(vUv * 30.0);
          color *= 0.8 + craterPattern * 0.4;

          vec3 lightDir = normalize(sunPosition - vPosition);
          float diff = max(dot(vNormal, lightDir), 0.0);

          vec3 viewDir = normalize(cameraPosition - vPosition);
          float rim = 1.0 - max(dot(viewDir, vNormal), 0.0);
          rim = pow(rim, 3.0);

          color *= (diff * 0.7 + 0.3);
          color += rim * vec3(0.3, 0.4, 0.6) * 0.3;
          gl_FragColor = vec4(color, 1.0);
        }
      `
    });

    const moon = new THREE.Mesh(moonGeometry, moonMaterial);
    moonGroup.add(moon);

    const moonAtmosphereGeo = new THREE.SphereGeometry(0.95, 64, 64);
    const moonAtmosphereMat = new THREE.ShaderMaterial({
      transparent: true,
      side: THREE.BackSide,
      blending: THREE.AdditiveBlending,
      uniforms: { time: { value: 0 } },
      vertexShader: `
        varying vec3 vNormal;
        void main() {
          vNormal = normalize(normalMatrix * normal);
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,
      fragmentShader: `
        uniform float time;
        varying vec3 vNormal;
        void main() {
          float intensity = pow(0.6 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0);
          vec3 atmosphereColor = vec3(0.5, 0.6, 0.9);
          float pulse = sin(time * 0.5) * 0.2 + 0.8;
          gl_FragColor = vec4(atmosphereColor, intensity * 0.4 * pulse);
        }
      `
    });

    const moonAtmosphere = new THREE.Mesh(moonAtmosphereGeo, moonAtmosphereMat);
    moonGroup.add(moonAtmosphere);

    const moonLight = new THREE.PointLight(0x8ca6db, 1.5, 12);
    moonGroup.add(moonLight);
    moonGroup.position.set(3, -1.5, 2);
    scene.add(moonGroup);

    // === CAMERA & RENDERER ===
    const sizes = { width: window.innerWidth, height: window.innerHeight };
    const camera = new THREE.PerspectiveCamera(75, sizes.width / sizes.height, 0.1, 100);
    camera.position.set(0, 1, 6);
    scene.add(camera);

    const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
    renderer.setSize(sizes.width, sizes.height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    window.addEventListener('resize', () => {
      sizes.width = window.innerWidth;
      sizes.height = window.innerHeight;
      camera.aspect = sizes.width / sizes.height;
      camera.updateProjectionMatrix();
      renderer.setSize(sizes.width, sizes.height);
    });

    let mouseX = 0;
    let mouseY = 0;

    // Better on mobile too
    window.addEventListener('pointermove', (event) => {
      mouseX = event.clientX / sizes.width - 0.5;
      mouseY = event.clientY / sizes.height - 0.5;
    }, { passive: true });

    // === ANIMATION LOOP ===
    const clock = new THREE.Clock();
    const tick = () => {
      const elapsedTime = clock.getElapsedTime();

      if (points) points.rotation.y = elapsedTime * 0.05;

      if(sunGroup) {
        sunGroup.rotation.y = elapsedTime * 0.1;
        sunGroup.children.forEach(child => {
          if(child.material && child.material.uniforms && child.material.uniforms.time) {
            child.material.uniforms.time.value = elapsedTime;
          }
        });
        const flarePts = sunGroup.children.find(c => c.type === 'Points');
        if(flarePts) {
          flarePts.rotation.y = elapsedTime * 0.5;
          flarePts.rotation.z = elapsedTime * 0.3;
        }
      }

      if(moonGroup) {
        moonGroup.rotation.y = elapsedTime * 0.05;
        moonGroup.children.forEach(child => {
          if(child.material && child.material.uniforms && child.material.uniforms.time) {
            child.material.uniforms.time.value = elapsedTime;
          }
        });
      }

      camera.position.x += (mouseX * 3 - camera.position.x) * 0.05;
      camera.position.y += (-mouseY * 2 + 1 - camera.position.y) * 0.05;
      camera.lookAt(0, 0.5, 0);

      renderer.render(scene, camera);
      window.requestAnimationFrame(tick);
    }
    tick();

    /***********************
     * DOM FLOWERS
     ***********************/
    const gardenFlowersContainer = document.getElementById('garden-flowers');
    const bouquetFlowersContainer = document.getElementById('bouquet-flowers');

    // Scatter many peonies around the scene, avoid the center area
    function createGardenPeonies() {
      gardenFlowersContainer.innerHTML = "";

      const count = 30; // number of flowers around the garden
      const centerAvoid = { x1: 28, x2: 72, y1: 20, y2: 92 }; // avoid bouquet area

      function pickPos() {
        for (let tries = 0; tries < 80; tries++) {
          const x = Math.random() * 100;
          const y = Math.random() * 100;

          const inCenter =
            x >= centerAvoid.x1 && x <= centerAvoid.x2 &&
            y >= centerAvoid.y1 && y <= centerAvoid.y2;

          // Prefer edges: if near edges, accept more easily
          const nearEdge = (x < 18 || x > 82 || y < 14 || y > 86);

          if (!inCenter && (nearEdge || Math.random() > 0.55)) {
            return { x, y };
          }
        }
        // fallback
        return { x: Math.random() < 0.5 ? 10 : 90, y: Math.random() * 100 };
      }

      for (let i = 0; i < count; i++) {
        const { x, y } = pickPos();

        const isPink = Math.random() > 0.5;
        const colorClass = isPink ? 'pink' : 'white';

        const flower = document.createElement('div');
        flower.className = 'garden-flower';
        flower.style.left = `${x.toFixed(2)}%`;
        flower.style.top  = `${y.toFixed(2)}%`;

        // final scale for GSAP
        const scale = 0.75 + Math.random() * 0.75; // 0.75..1.5
        flower.dataset.finalScale = scale.toFixed(2);

        const inner = document.createElement('div');
        inner.className = 'garden-flower-inner';
        inner.style.animationDelay = `${Math.random() * 2}s`;

        // Create CSS peony flower
        const peonyDiv = document.createElement('div');
        peonyDiv.className = `garden-flower-img css-peony ${colorClass}`;
        peonyDiv.style.setProperty('--img-rot', `${(Math.random() * 24 - 12).toFixed(1)}deg`);

        // Create 22 petals (outer, middle, inner layers)
        for (let p = 0; p < 22; p++) {
          const petal = document.createElement('div');
          petal.className = 'peony-petal';
          peonyDiv.appendChild(petal);
        }

        // Add center
        const center = document.createElement('div');
        center.className = 'peony-center';
        peonyDiv.appendChild(center);

        inner.appendChild(peonyDiv);
        flower.appendChild(inner);
        gardenFlowersContainer.appendChild(flower);
      }
    }

    // Tulip bouquet
    function createTulipBouquet() {
      bouquetFlowersContainer.innerHTML = '';

      const tulipCount = 100;
      const golden = Math.PI * (3 - Math.sqrt(5));

      for (let i = 0; i < tulipCount; i++) {
        const t = i / tulipCount;
        const r = Math.sqrt(t);
        const ang = i * golden;

        const cx = 50;
        const cy = 38;
        const spreadX = 34;
        const spreadY = 22;

        const x = cx + Math.cos(ang) * r * spreadX + (Math.random() - 0.5) * 2.0;
        const y = cy + Math.sin(ang) * r * spreadY + (Math.random() - 0.5) * 2.0;

        const z  = Math.round((1 - r) * 40 - r * 80);
        const rot = (Math.random() * 26 - 13) + 'deg';
        const zi  = Math.round(200 - r * 120);

        const tulip = document.createElement('div');
        tulip.className = 'css-tulip';
        tulip.style.setProperty('--x', x.toFixed(2) + '%');
        tulip.style.setProperty('--y', y.toFixed(2) + '%');
        tulip.style.setProperty('--z', z + 'px');
        tulip.style.setProperty('--rot', rot);
        tulip.style.setProperty('--zi', zi);

        const unit = document.createElement('div');
        unit.className = 'tulip-unit';

        const head = document.createElement('div');
        head.className = 'tulip-head';

        const glow = document.createElement('div');
        glow.className = 'tulip-glow';
        head.appendChild(glow);

        const p1 = document.createElement('div'); p1.className = 'tulip-petal p1';
        const p2 = document.createElement('div'); p2.className = 'tulip-petal p2';
        const p3 = document.createElement('div'); p3.className = 'tulip-petal p3';
        head.appendChild(p1); head.appendChild(p2); head.appendChild(p3);

        const i1 = document.createElement('div'); i1.className = 'tulip-petal inner i1';
        const i2 = document.createElement('div'); i2.className = 'tulip-petal inner i2';
        head.appendChild(i1); head.appendChild(i2);

        unit.appendChild(head);

        const stem = document.createElement('div');
        stem.className = 'tulip-stem';
        unit.appendChild(stem);

        const leaf1 = document.createElement('div');
        leaf1.className = 'tulip-leaf';
        unit.appendChild(leaf1);

        if (Math.random() > 0.55) {
          const leaf2 = document.createElement('div');
          leaf2.className = 'tulip-leaf alt';
          unit.appendChild(leaf2);
        }

        tulip.appendChild(unit);
        bouquetFlowersContainer.appendChild(tulip);
      }
    }

    // Build flowers immediately (no preload needed for CSS flowers)
    createGardenPeonies();
    createTulipBouquet();

    /***********************
     * UI INTERACTION
     ***********************/
    let step = 0;
    const lightBurst = document.getElementById('light-burst');
    const gallery = document.getElementById('gallery-container');
    const instruction = document.getElementById('start-instruction');
    const btn = document.getElementById('give-flower-btn');
    const gardenScene = document.getElementById('garden-scene');
    const bouquetContainer = document.getElementById('bouquet-container');

    let allPhotosShown = false;
    let slideshowCount = 0;

    document.body.addEventListener('click', () => {
      if (step === 0) {
        step = 1;

        const tl = gsap.timeline();

        tl.to(instruction, { 
            opacity: 0, 
            duration: 0.5,
            onComplete: () => {
              instruction.style.visibility = 'hidden';
            }
          })
          .to(sunGroup.position,  { x: 0, y: 0, z: 1, duration: 2, ease: "power2.inOut" }, "merge")
          .to(moonGroup.position, { x: 0, y: 0, z: 1, duration: 2, ease: "power2.inOut" }, "merge")
          .to(lightBurst, {
            width: '150vmax',
            height: '150vmax',
            opacity: 0.9,
            duration: 0.3,
            ease: "power2.out"
          }, "-=0.3")
          .to(lightBurst, {
            opacity: 0,
            duration: 0.5,
            ease: "power2.in"
          })
          .to(canvas, { opacity: 0.85, duration: 0.8 }, "-=0.5")
          .to(sunGroup.scale,  { x: 0, y: 0, z: 0, duration: 0.4 }, "-=0.8")
          .to(moonGroup.scale, { x: 0, y: 0, z: 0, duration: 0.4 }, "-=0.8")
          .to(gallery, { autoAlpha: 1, scale: 1, duration: 1, ease: "back.out(1.3)" }, "-=0.3");

        startSlideshow();
      }
    });

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (step === 1 && allPhotosShown) {
        step = 2;

        const tl = gsap.timeline();
        const valentineCard = document.getElementById('valentine-card');

        tl.to(btn, { scale: 0, opacity: 0, duration: 0.4 })
          .to(gallery, { scale: 0, opacity: 0, duration: 0.6 })
          .to(gardenScene, {
            opacity: 1,
            visibility: 'visible',
            duration: 1.5
          })
          .call(() => {
            // Bloom garden peonies
            const flowers = gardenFlowersContainer.querySelectorAll('.garden-flower');
            flowers.forEach((flower, i) => {
              const finalScale = Number(flower.dataset.finalScale || 1);
              setTimeout(() => {
                gsap.to(flower, {
                  opacity: 1,
                  scale: finalScale,
                  duration: 1.4,
                  ease: 'elastic.out(1, 0.55)'
                });
              }, i * 90);
            });
          })
          .to(bouquetContainer, {
            bottom: '5%',
            duration: 2.5,
            ease: 'elastic.out(1, 0.4)',
            delay: 0.8
          })
          .call(() => {
            // Animate tulips bloom (IMPORTANT: animate .tulip-unit)
            const units = bouquetFlowersContainer.querySelectorAll('.tulip-unit');
            units.forEach((unit, i) => {
              setTimeout(() => {
                gsap.to(unit, {
                  opacity: 1,
                  scale: 1,
                  duration: 1.1,
                  ease: 'back.out(1.2)'
                });
              }, i * 16);
            });
          }, '-=1.6')
          .to(valentineCard, {
            opacity: 1,
            scale: 1,
            duration: 1.2,
            ease: 'elastic.out(1, 0.6)',
            delay: 2.0
          });
      }
    });

    function startSlideshow() {
      const slides = document.querySelectorAll('.photo-slide');
      let index = 0;

      setInterval(() => {
        slides[index].classList.remove('active');
        
        // Pause video if leaving it
        if (slides[index].tagName === 'VIDEO') {
          slides[index].pause();
          slides[index].currentTime = 0;
        }
        
        index = (index + 1) % slides.length;
        slides[index].classList.add('active');
        
        // Play video if entering it
        if (slides[index].tagName === 'VIDEO') {
          slides[index].play();
        }

        slideshowCount++;

        if(slideshowCount >= slides.length && !allPhotosShown) {
          allPhotosShown = true;
          gsap.to(btn, {
            autoAlpha: 1,
            y: 0,
            duration: 0.8,
            ease: "back.out(1.3)",
            delay: 0.5
          });
        }
      }, 3000);
    }
  </script>
</body>
</html>